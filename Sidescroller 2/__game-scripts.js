var Follow=pc.createScript("follow");Follow.attributes.add("target",{type:"entity",title:"Target",description:"The Entity to follow"}),Follow.attributes.add("distance",{type:"number",default:4,title:"Distance",description:"How far from the Entity should the follower be"}),Follow.prototype.initialize=function(){this.vec=new pc.Vec3},Follow.prototype.update=function(t){if(this.target){var e=this.target.getPosition();e.x+=.75*this.distance,e.y+=.75*this.distance,e.z+=.75*this.distance,this.vec.lerp(this.vec,e,.1),this.entity.setPosition(this.vec)}};var Movement=pc.createScript("movement");Movement.attributes.add("speed",{type:"number",default:.1,min:.05,max:.5,precision:2,description:"Controls the movement speed"}),Movement.prototype.initialize=function(){this.force=new pc.Vec3,this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.entity.collision.on("collisionstart",this.onCollisionStart,this),this.canJump=1,this.app.keyboard.on(pc.EVENT_KEYDOWN,this.keyDown,this),this.app.keyboard.on(pc.EVENT_KEYUP,this.keyUp,this)},Movement.prototype.onCollisionStart=function(e){e.other.rigidbody&&(this.canJump=1)},Movement.prototype.update=function(e){this.app.keyboard.wasPressed(pc.KEY_P)&&"Punch"!==this.entity.anim.baseLayer.activeState&&this.entity.anim.setBoolean("Punch",!0),this.app.keyboard.wasReleased(pc.KEY_P)&&"Punch"===this.entity.anim.baseLayer.activeState&&this.entity.anim.setBoolean("Punch",!1),this.app.keyboard.wasPressed(pc.KEY_SPACE)&&"Jump"!==this.entity.anim.baseLayer.activeState&&this.entity.anim.setBoolean("Jump",!0),this.app.keyboard.wasReleased(pc.KEY_SPACE)&&"Jump"===this.entity.anim.baseLayer.activeState&&this.entity.anim.setBoolean("Jump",!1),this.app.keyboard.wasPressed(pc.KEY_LEFT)&&"Run"!==this.entity.anim.baseLayer.activeState&&this.entity.anim.setBoolean("Run",!0),this.app.keyboard.wasReleased(pc.KEY_LEFT)&&"Run"===this.entity.anim.baseLayer.activeState&&this.entity.anim.setBoolean("Run",!1),this.app.keyboard.wasPressed(pc.KEY_RIGHT)&&"Run"!==this.entity.anim.baseLayer.activeState&&this.entity.anim.setBoolean("Run",!0),this.app.keyboard.wasReleased(pc.KEY_RIGHT)&&"Run"===this.entity.anim.baseLayer.activeState&&this.entity.anim.setBoolean("Run",!1),this.app.keyboard.wasPressed(pc.KEY_UP)&&"Run"!==this.entity.anim.baseLayer.activeState&&this.entity.anim.setBoolean("Run",!0),this.app.keyboard.wasReleased(pc.KEY_UP)&&"Run"===this.entity.anim.baseLayer.activeState&&this.entity.anim.setBoolean("Run",!1),this.app.keyboard.wasPressed(pc.KEY_DOWN)&&"Run"!==this.entity.anim.baseLayer.activeState&&this.entity.anim.setBoolean("Run",!0),this.app.keyboard.wasPressed(pc.KEY_DOWN)&&"Run"===this.entity.anim.baseLayer.activeState&&this.entity.anim.setBoolean("Run",!1);var t=0,i=0;if(this.app.keyboard.isPressed(pc.KEY_LEFT)&&(t=-this.speed),this.app.keyboard.isPressed(pc.KEY_RIGHT)&&(t+=this.speed),this.app.keyboard.isPressed(pc.KEY_UP)&&(i=-this.speed),this.app.keyboard.isPressed(pc.KEY_DOWN)&&(i+=this.speed),this.force.x=t,this.force.z=i,this.force.length()){var s=Math.cos(.25*-Math.PI),a=Math.sin(.25*-Math.PI);this.force.set(this.force.x*s-this.force.z*a,0,this.force.z*s+this.force.x*a),this.force.length()>this.speed&&this.force.normalize().scale(this.speed)}this.entity.rigidbody.applyImpulse(this.force)},Movement.prototype.onKeyDown=function(e){e.key==pc.KEY_SPACE&&1==this.canJump&&(this.entity.rigidbody.applyImpulse(0,2,0),this.canJump=0)};var Teleportable=pc.createScript("teleportable");Teleportable.prototype.initialize=function(){this.lastTeleportFrom=null,this.lastTeleportTo=null,this.lastTeleport=Date.now(),this.startPosition=this.entity.getPosition().clone()},Teleportable.prototype.update=function(t){this.entity.getPosition().y<0&&this.teleport(this.lastTeleportFrom,this.lastTeleportTo)},Teleportable.prototype.teleport=function(t,e){var o;t&&Date.now()-this.lastTeleport<500||(this.lastTeleport=Date.now(),this.lastTeleportFrom=t,this.lastTeleportTo=e,e?(o=e.getPosition()).y+=.5:o=this.startPosition,this.entity.rigidbody.teleport(o),this.entity.rigidbody.linearVelocity=pc.Vec3.ZERO,this.entity.rigidbody.angularVelocity=pc.Vec3.ZERO)};var Teleport=pc.createScript("teleport");Teleport.attributes.add("target",{type:"entity",title:"Target Entity",description:"The target entity where we are going to teleport"}),Teleport.prototype.initialize=function(){this.target&&this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},Teleport.prototype.onTriggerEnter=function(t){t.script.teleportable&&t.script.teleportable.teleport(this.entity,this.target)};var Enemy=pc.createScript("enemy");Enemy.prototype.initialize=function(){this.entity.collision.on("collisionstart",this.onCollisionStart,this),this.entity.collision.on("contact",this.duringContact,this)},Enemy.prototype.onCollisionStart=function(t){"enemy1"!=t.other.name&&"ENEMYTYPE1"!=t.other.name||this.entity.getPosition().y>t.other.getPosition().y&&t.other.destroy()},Enemy.prototype.duringContact=function(t){"enemy1"!=t.other.name&&"ENEMYTYPE1"!=t.other.name||"Punch"===this.entity.anim.baseLayer.activeState&&t.other.destroy()},Enemy.prototype.update=function(t){};var EnemyAI=pc.createScript("enemyAI");EnemyAI.attributes.add("range",{type:"number",default:10,title:"Detection Range"}),EnemyAI.attributes.add("speed",{type:"number",default:5,title:"Movement Speed"}),EnemyAI.prototype.initialize=function(){this.player=this.app.root.findByName("PlayerCharacter"),this.player||console.error('Player entity with the name "PlayerCharacter" was not found.')},EnemyAI.prototype.update=function(e){if(this.player){var t=this.entity.getPosition(),i=this.player.getPosition();if(t.distance(i)<this.range){var a=i.clone().sub(t).normalize();this.entity.rigidbody.applyForce(a.scale(this.speed))}}};var AiMovement=pc.createScript("aiMovement");AiMovement.prototype.initialize=function(){this.speed=1,this.distance=3,this.direction=1,this.traveled=0},AiMovement.prototype.update=function(t){var e=this.speed*t*this.direction;this.entity.translateLocal(0,0,e),this.traveled+=e,Math.abs(this.traveled)>=this.distance&&(this.direction*=-1,this.traveled=0)};var Proceduralgeneration=pc.createScript("proceduralgeneration");Proceduralgeneration.prototype.initialize=function(){},Proceduralgeneration.prototype.update=function(e){};